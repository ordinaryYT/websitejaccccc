<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ThatLegendJack</title>
<style>
  :root {
    --ars-red: #EF0107;
    --ars-white: #FFF;
    --ars-navy: #063672;
    --ars-gold: #9C824A;
  }

  /* Body */
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,var(--ars-red) 0%,var(--ars-white) 35%,var(--ars-navy) 70%,var(--ars-gold) 100%);
    color: #fff;
    min-height: 100vh;
    text-align: center;
    overflow-x: hidden;
  }

  /* Heading (animated gradient text) */
  h1 {
    margin-top: 1rem;
    font-size: 2.8rem;
    font-weight: 900;
    text-shadow: 2px 2px 5px #000;
    background: linear-gradient(270deg, #EF0107, #FFFFFF, #063672, #EF0107);
    background-size: 600% 600%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    color: transparent;
    animation: gradientShift 8s ease infinite;
  }
  @keyframes gradientShift {
    0%   { background-position: 0% 50%; }
    50%  { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* Login Box */
  .login-container {
    position: fixed;
    top: 10px;
    right: 20px;
    background: rgba(0, 0, 0, .8);
    padding: 1rem;
    border-radius: 10px;
  }
  .login-container a,
  .login-container button {
    display: block;
    padding: .7rem 1rem;
    background: var(--ars-red);
    color: #fff;
    font-weight: 700;
    text-decoration: none;
    border-radius: 8px;
    box-shadow: 2px 2px 6px rgba(0, 0, 0, .6);
    border: none;
    cursor: pointer;
  }
  .login-container a:hover,
  .login-container button:hover { background: var(--ars-gold); }

  /* Navigation */
  .nav-center {
    margin: 1.25rem auto 0;
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .nav-box {
    display: block;
    min-width: 180px;
    padding: 1rem 2rem;
    font-weight: 800;
    color: #fff;
    text-decoration: none;
    border-radius: 12px;
    box-shadow: 2px 2px 8px rgba(0,0,0,.6);
    transition: transform .2s, filter .3s;
  }
  .nav-box:hover { transform: translateY(-3px); filter: brightness(1.05); }
  .about { background: linear-gradient(135deg, var(--ars-red) 0%, var(--ars-gold) 100%); border: 2px solid var(--ars-white); }
  .leaderboards { background: linear-gradient(135deg, var(--ars-navy) 0%, var(--ars-white) 100%); border: 2px solid var(--ars-white); }

  /* Twitch Player */
  .player-wrap { max-width: 900px; margin: 1.25rem auto 0; padding: 0 1rem; }
  .player-frame {
    position: relative; width: 100%; aspect-ratio: 16/9;
    background: #0e0e10; border: 2px solid var(--ars-gold);
    border-radius: 12px; overflow: hidden;
    box-shadow: 0 8px 24px rgba(0,0,0,.35);
  }
  .player-frame #twitch-player,
  .player-frame iframe { position: absolute; inset: 0; width: 100%; height: 100%; }
  .offline-banner {
    position: absolute; inset: 0; display: flex; flex-direction: column;
    align-items: center; justify-content: center; gap: .75rem;
    background: rgba(0,0,0,.8); text-align: center; padding: 1rem;
    visibility: hidden; opacity: 0; transition: .25s;
  }
  .offline-banner img {
    max-width: 75%; height: auto; border-radius: 8px;
    box-shadow: 0 6px 18px rgba(0,0,0,.45);
  }
  .offline-banner .offline-text { color: #fff; }
  .offline-btn {
    display: inline-block; margin-top: .25rem; padding: .5rem .9rem;
    border-radius: 8px; background: linear-gradient(135deg,var(--ars-red),var(--ars-gold));
    color: #fff; text-decoration: none; font-weight: 800;
  }
  .offline-show { visibility: visible; opacity: 1; }
  .player-note { display: block; opacity: .8; margin-top: .35rem; }

  /* Social Links */
  .social-bar {
    position: fixed; top: 50%; left: 10px; transform: translateY(-50%);
    display: flex; flex-direction: column; gap: 2rem;
  }
  .social-link {
    width: 65px; height: 65px; border-radius: 50%; overflow: hidden;
    background: #000; box-shadow: 2px 2px 6px rgba(0,0,0,.6);
    display: flex; align-items: center; justify-content: center;
    transition: transform .2s, box-shadow .3s;
  }
  .social-link img { width: 100%; height: 100%; object-fit: cover; }
  .social-link:hover { transform: scale(1.1); box-shadow: 0 0 15px var(--ars-gold); }

  /* Status Circles */
  .status-container {
    position: fixed; bottom: 20px; right: 20px;
    display: flex; gap: 1.2rem; align-items: flex-end; flex-wrap: wrap;
  }
  .circle {
    width: 110px; height: 110px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: .82rem; text-align: center; padding: 8px;
    box-shadow: 2px 2px 6px rgba(0,0,0,.6);
  }
  .spotify { background: #1DB954; color: #000; }
  .discord { background: #7289DA; color: #fff; }
  .track { display: inline-block; max-width: 92px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

  /* Panels */
  .panel {
    position: fixed; background: rgba(0,0,0,.75); border: 2px solid var(--ars-gold);
    border-radius: 12px; padding: 12px; width: min(360px,92vw); text-align: left;
  }
  #adminPanel { top: 20px; left: 20px; display: none; }
  #staffPanel { top: 90px; right: 20px; display: none; }

  .row { display: flex; gap: .5rem; margin: .45rem 0; }
  .row input,.row textarea { flex: 1; padding: .5rem; border: none; border-radius: 8px; }
  .row button {
    padding: .5rem .8rem; border: none; border-radius: 8px;
    background: var(--ars-red); color: #fff; font-weight: 700; cursor: pointer;
  }
  .list {
    max-height: 160px; overflow: auto;
    border: 1px solid rgba(255,255,255,.2);
    padding: .5rem; border-radius: 8px;
  }
  .badge {
    display: inline-block; background: #333;
    padding: .15rem .45rem; border-radius: 6px;
    margin-left: .35rem; font-size: .75rem;
  }

  /* Responsive */
  @media(max-width:900px) {
    .player-wrap { margin-top: 1rem; }
  }
  @media(max-width:600px) {
    .circle { width: 78px; height: 78px; font-size: .6rem; }
    .track { max-width: 62px; }
    .social-bar { left: 5px; gap: 1.2rem; }
    .social-link { width: 50px; height: 50px; }
  }
</style>
</head>
<body>
  <h1>ThatLegendJack</h1>

  <!-- Login / Logout -->
  <div class="login-container" id="authBox"><a href="login.html">Login</a></div>

  <!-- Nav -->
  <div class="nav-center">
    <a class="nav-box about" href="about.html">About Me</a>
    <a class="nav-box leaderboards" href="leaderboards.html">Leaderboards</a>
  </div>

  <!-- Twitch Live Player -->
  <section class="player-wrap">
    <div class="player-frame">
      <div id="twitch-player"></div>
      <div id="twitch-offline" class="offline-banner">
        <img src="images/twitch-offline.jpg" alt="Stream is offline" />
        <div class="offline-text">
          <strong>ThatLegendJackk is currently offline.</strong><br/>
          Check back soon or visit the channel!
        </div>
        <a class="offline-btn" target="_blank" href="https://www.twitch.tv/ThatLegendJackk">Go to Twitch</a>
      </div>
    </div>
    <small class="player-note">If the player doesn’t load on localhost, serve the page over http(s); the Twitch embed requires a matching <em>parent</em> domain.</small>
  </section>

  <!-- Social (Twitch/TikTok/Kick use profile pics; OnlyFans keeps logo) -->
  <div class="social-bar">
    <a class="social-link" id="link_twitch" href="https://www.twitch.tv/ThatLegendJackk" target="_blank">
      <img id="img_twitch" src="images/twitch-logo.png" alt="Twitch">
    </a>
    <a class="social-link" id="link_tiktok" href="https://www.tiktok.com/@ThatLegendJackk" target="_blank">
      <img id="img_tiktok" src="images/tiktok-logo.png" alt="TikTok">
    </a>
    <a class="social-link" id="link_kick" href="https://kick.com/ThatLegendJackk" target="_blank">
      <img id="img_kick" src="images/kick-logo.png" alt="Kick">
    </a>
    <a class="social-link" id="link_onlyfans" href="https://onlyfans.com/yourlink" target="_blank">
      <img id="img_onlyfans" src="images/onlyfans-logo.png" alt="OnlyFans">
    </a>
  </div>

  <!-- Status circles -->
  <div class="status-container">
    <div class="circle spotify" id="spotify-status" title="Spotify now playing">
      <span class="track" id="spotify-track">Spotify: Not Playing</span>
    </div>
    <div class="circle discord" id="discord-status">Discord: Offline</div>
  </div>

  <!-- Staff Panel -->
  <div class="panel" id="staffPanel">
    <h3>Staff Panel</h3>
    <small>Signed in as <span id="who"></span> <span class="badge" id="roleBadge"></span></small>

    <!-- Edit social links -->
    <div class="row"><input id="in_twitch" placeholder="Twitch URL"><button onclick="saveLink('twitch')">Save</button></div>
    <div class="row"><input id="in_tiktok" placeholder="TikTok URL"><button onclick="saveLink('tiktok')">Save</button></div>
    <div class="row"><input id="in_kick" placeholder="Kick URL"><button onclick="saveLink('kick')">Save</button></div>
    <div class="row"><input id="in_onlyfans" placeholder="OnlyFans URL"><button onclick="saveLink('onlyfans')">Save</button></div>

    <!-- Edit profile image URLs for Twitch/TikTok/Kick -->
    <div class="row"><input id="imgurl_twitch" placeholder="Twitch Profile Image URL"><button onclick="saveImg('twitch')">Save</button></div>
    <div class="row"><input id="imgurl_tiktok" placeholder="TikTok Profile Image URL"><button onclick="saveImg('tiktok')">Save</button></div>
    <div class="row"><input id="imgurl_kick" placeholder="Kick Profile Image URL"><button onclick="saveImg('kick')">Save</button></div>

    <!-- Discord status override -->
    <div class="row"><input id="in_discord" placeholder="Discord status…"><button onclick="saveText('discord-status','in_discord')">Save</button></div>

    <!-- Spotify: paste access token once (stored locally) -->
    <div class="row">
      <textarea id="spotify_token" placeholder="Paste Spotify ACCESS TOKEN (scope: user-read-currently-playing or user-read-playback-state)"></textarea>
      <button onclick="saveSpotifyToken()">Save</button>
    </div>
    <small style="opacity:.85;display:block;margin-top:-.2rem">Token saved in this browser. For production, use a server to refresh tokens.</small>

    <div class="row"><button class="logout" onclick="logout()">Logout</button></div>
  </div>

  <!-- Admin Panel (top-left) -->
  <div class="panel" id="adminPanel">
    <h3>Admin Panel</h3>
    <small>Manage staff users on this device</small>
    <div class="row">
      <input id="newUser" placeholder="Username">
      <input id="newPass" placeholder="Password">
      <button onclick="addStaff()">Add</button>
    </div>
    <div class="list" id="userList">Loading users…</div>
  </div>

<script src="https://embed.twitch.tv/embed/v1.js"></script>
<script>
/* ===== Users/session helpers ===== */
function loadUsers(){ try{return JSON.parse(localStorage.getItem('users')||'[]')}catch{return[]} }
function saveUsers(arr){ localStorage.setItem('users', JSON.stringify(arr)); }
function isLoggedIn(){ return localStorage.getItem('staffSession')==='true'; }
function role(){ return localStorage.getItem('staffRole')||'viewer'; }

/* ===== Auth UI ===== */
function showAuth(){
  const box=document.getElementById('authBox');
  if(isLoggedIn()){
    const name=localStorage.getItem('staffName')||'staff';
    box.innerHTML=`<button onclick="logout()">Logout (${name})</button>`;
  }else{
    box.innerHTML=`<a href="login.html">Login</a>`;
  }
}
function showPanels(){
  const staff = isLoggedIn();
  const r = role();
  document.getElementById('staffPanel').style.display = staff ? 'block':'none';
  document.getElementById('adminPanel').style.display = (staff && r==='admin') ? 'block':'none';
  if(staff){
    document.getElementById('who').textContent = localStorage.getItem('staffName')||'staff';
    document.getElementById('roleBadge').textContent = r;
    prefillInputs();
    if(r==='admin') renderUsers();
  }
}

/* ===== Social links + images ===== */
const socialKeys=['twitch','tiktok','kick','onlyfans'];
function applyLinks(){
  socialKeys.forEach(k=>{
    const url = localStorage.getItem('link_'+k);
    if(url) document.getElementById('link_'+k).href = url;
  });
}
function applyImages(){
  ['twitch','tiktok','kick'].forEach(k=>{
    const saved = localStorage.getItem('img_'+k);
    if(saved) document.getElementById('img_'+k).src = saved;
  });
}
function saveLink(key){
  if(!isLoggedIn()) return;
  const val=document.getElementById('in_'+key).value.trim();
  if(!val) return;
  localStorage.setItem('link_'+key,val);
  document.getElementById('link_'+key).href=val;
}
function saveImg(key){
  if(!isLoggedIn()) return;
  const val=document.getElementById('imgurl_'+key).value.trim();
  if(!val) return;
  localStorage.setItem('img_'+key, val);
  document.getElementById('img_'+key).src = val;
}

/* ===== Status text ===== */
function saveText(targetId,inputId){
  if(!isLoggedIn()) return;
  const val=document.getElementById(inputId).value.trim();
  if(!val) return;
  localStorage.setItem(targetId,val);
  document.getElementById(targetId).textContent=val;
}
function prefillInputs(){
  socialKeys.forEach(k=>{
    const el=document.getElementById('in_'+k);
    if(el){ el.value = localStorage.getItem('link_'+k) || document.getElementById('link_'+k).href; }
  });
  ['twitch','tiktok','kick'].forEach(k=>{
    const el=document.getElementById('imgurl_'+k);
    if(el) el.value = localStorage.getItem('img_'+k) || "";
  });
  document.getElementById('in_discord').value = localStorage.getItem('discord-status') || document.getElementById('discord-status').textContent;
  const savedTok = localStorage.getItem('spotify_access_token') || "";
  const tokBox = document.getElementById('spotify_token');
  if(tokBox) tokBox.value = savedTok;
}

/* ===== Admin user management ===== */
function renderUsers(){
  const list=document.getElementById('userList');
  const users=loadUsers();
  list.innerHTML='';
  users.forEach((u,i)=>{
    const row=document.createElement('div');
    row.style.display='flex'; row.style.justifyContent='space-between'; row.style.margin='.3rem 0';
    row.innerHTML=`<div>${u.username} <span class="badge">${u.role}</span></div>
      <button onclick="removeUser(${i})" style="background:#444;color:#fff;border:none;border-radius:8px;padding:.35rem .6rem">Remove</button>`;
    if(u.role==='admin') row.querySelector('button').disabled=true;
    list.appendChild(row);
  });
}
function addStaff(){
  const u=document.getElementById('newUser').value.trim();
  const p=document.getElementById('newPass').value.trim();
  if(!u||!p) return;
  const users=loadUsers();
  if(users.some(x=>x.username===u)) return alert('User already exists.');
  users.push({username:u,password:p,role:'staff'});
  saveUsers(users);
  document.getElementById('newUser').value=''; document.getElementById('newPass').value='';
  renderUsers();
}
function removeUser(idx){
  const users=loadUsers();
  users.splice(idx,1);
  saveUsers(users);
  renderUsers();
}

/* ===== Session ===== */
function logout(){
  localStorage.removeItem('staffSession');
  localStorage.removeItem('staffName');
  localStorage.removeItem('staffRole');
  showAuth(); showPanels();
}

/* ===== Spotify: Now Playing ===== */
function saveSpotifyToken(){
  if(!isLoggedIn()) return;
  const t = (document.getElementById('spotify_token').value || "").trim();
  if(!t) return;
  localStorage.setItem('spotify_access_token', t);
  updateSpotifyNowPlaying(true);
}
let spotifyTimer = null;
async function fetchSpotifyCurrentlyPlaying(token){
  const res = await fetch('https://api.spotify.com/v1/me/player/currently-playing', {
    headers: { 'Authorization': 'Bearer ' + token }
  });
  if(res.status === 204) return null;
  if(!res.ok){
    const text = await res.text();
    throw new Error(`${res.status} ${res.statusText}: ${text}`);
  }
  return res.json();
}
async function updateSpotifyNowPlaying(immediate=false){
  const token = localStorage.getItem('spotify_access_token') || '';
  const el = document.getElementById('spotify-track');
  if(!token){
    el.textContent = 'Spotify: Not Connected';
    return;
  }
  try{
    const data = await fetchSpotifyCurrentlyPlaying(token);
    if(!data || !data.item){
      el.textContent = 'Spotify: Not Playing';
    }else{
      const name = data.item.name;
      const artists = (data.item.artists||[]).map(a=>a.name).join(', ');
      el.textContent = `${name} — ${artists}`;
      el.parentElement.title = `Now playing: ${name} — ${artists}`;
    }
  }catch(err){
    console.error('Spotify error:', err);
    el.textContent = 'Spotify: Re-auth needed';
  }finally{
    clearTimeout(spotifyTimer);
    spotifyTimer = setTimeout(updateSpotifyNowPlaying, 15000);
  }
}

/* ===== Twitch Live Player ===== */
const TW_LS_CLIENT_ID = 'twitch_client_id';
const TW_LS_TOKEN     = 'twitch_access_token';
const TWITCH_CHANNEL  = 'ThatLegendJackk'; /* channel to embed */
let twitchPlayer = null;
let liveCheckTimer = null;

function createTwitchPlayer(){
  if(twitchPlayer) return twitchPlayer;
  const parentHost = location.hostname || 'localhost';
  twitchPlayer = new Twitch.Embed("twitch-player", {
    width: "100%", height: "100%",
    channel: TWITCH_CHANNEL, layout: "video", muted: true,
    parent: [parentHost]
  });
  return twitchPlayer;
}
async function helixGet(path, params = {}){
  const CLIENT_ID = localStorage.getItem(TW_LS_CLIENT_ID) || '';
  const TOKEN     = localStorage.getItem(TW_LS_TOKEN) || '';
  if(!CLIENT_ID || !TOKEN) return { missingCreds:true };
  const url = new URL(`https://api.twitch.tv/helix/${path}`);
  Object.entries(params).forEach(([k,v])=>{
    if(v!==undefined && v!==null && v!=='') url.searchParams.set(k,v);
  });
  const res = await fetch(url, { headers: { 'Client-Id': CLIENT_ID, 'Authorization': `Bearer ${TOKEN}` } });
  if(!res.ok){
    const body = await res.text();
    throw new Error(`${res.status} ${res.statusText}: ${body}`);
  }
  return res.json();
}
function setOfflineOverlay(show){
  const el = document.getElementById('twitch-offline');
  if(!el) return;
  if(show) el.classList.add('offline-show'); else el.classList.remove('offline-show');
}
async function updateTwitchLiveStatus(){
  try{
    const result = await helixGet('streams', { user_login: TWITCH_CHANNEL });
    if(result && result.missingCreds){
      createTwitchPlayer();
      setOfflineOverlay(false);
      return;
    }
    const live = Array.isArray(result.data) && result.data.length > 0;
    createTwitchPlayer();
    setOfflineOverlay(!live);
  }catch(err){
    console.error('Twitch live check error:', err);
    setOfflineOverlay(true);
  }finally{
    clearTimeout(liveCheckTimer);
    liveCheckTimer = setTimeout(updateTwitchLiveStatus, 60000);
  }
}

/* ===== Init ===== */
applyLinks();
applyImages();
showAuth();
showPanels();

const savedDiscord=localStorage.getItem('discord-status');
if(savedDiscord) document.getElementById('discord-status').textContent=savedDiscord;

updateSpotifyNowPlaying(true);
updateTwitchLiveStatus();
</script>
</body>
</html>
